# handlers/achievements.py
"""–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏ –ø–∏–≤–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞."""
import os

# –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
ASSETS_PATH = os.path.join(os.path.dirname(os.path.dirname(__file__)), 'assets')

# –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ –æ–±—ä–µ–º—É –≤—ã–ø–∏—Ç–æ–≥–æ –ø–∏–≤–∞ (–≤ –ª–∏—Ç—Ä–∞—Ö)
ACHIEVEMENTS = [
    {
        "volume": 1,
        "title": "–ü–∞–¥–∞–≤–∞–Ω –ü–∏–≤–Ω–æ–≥–æ –û—Ä–¥–µ–Ω–∞",
        "message": "–°–∏–ª–∞ –ø–∏–≤–∞ —Å —Ç–æ–±–æ–π, –Ω–æ —Ç—ã –µ—â–µ –Ω–µ –¥–∂–µ–¥–∞–π –∫—Ä—É–∂–∫–∏! üöÄ",
        "icon": "üöÄ",
        "image": os.path.join(ASSETS_PATH, "–ü–∞–¥–∞–≤–∞–Ω –ü–∏–≤–Ω–æ–≥–æ –û—Ä–¥–µ–Ω–∞.jpg")
    },
    {
        "volume": 5,
        "title": "–•–æ–±–±–∏—Ç –∏–∑ –®–∏—Ä–∞",
        "message": "–¢—ã —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª –ø–æ–ø–∏–≤–∞—Ç—å —ç–ª—å –≤ —Ç–∞–≤–µ—Ä–Ω–µ –ó–µ–ª–µ–Ω–æ–≥–æ –î—Ä–∞–∫–æ–Ω–∞! üßô‚Äç‚ôÇÔ∏è",
        "icon": "üßô‚Äç‚ôÇÔ∏è",
        "image": os.path.join(ASSETS_PATH, "–•–æ–±–±–∏—Ç –∏–∑ –®–∏—Ä–∞.png")
    },
    {
        "volume": 10,
        "title": "–°—Ç—Ä–∞–∂ –ü–µ–Ω–Ω–æ–≥–æ –°—Ç–∞–Ω–∞",
        "message": "–¢—ã –∑–∞—â–∏—â–∞–µ—à—å –±–∞—Ä –æ—Ç —Ç—Ä–µ–∑–≤–µ–Ω–Ω–∏–∫–æ–≤, –Ω–æ –∑–∏–º–∞ –±–ª–∏–∑–∫–æ! üê∫",
        "icon": "üê∫",
        "image": os.path.join(ASSETS_PATH, "–°—Ç—Ä–∞–∂ –ü–µ–Ω–Ω–æ–≥–æ –°—Ç–∞–Ω–∞.jpg")
    },
    {
        "volume": 20,
        "title": "–ü–∏–≤–Ω–æ–π –§–∞–ª–∫–æ–Ω",
        "message": "–¢–≤–æ—è –∫—Ä—É–∂–∫–∞ –ø—Ä–æ–ª–µ—Ç–∞–µ—Ç –ø–∏–≤–Ω–æ–π –≥–∏–ø–µ—Ä–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –∑–∞ 12 –ø–∞—Ä—Å–µ–∫–æ–≤! üõ∏",
        "icon": "üõ∏",
        "image": os.path.join(ASSETS_PATH, "–ü–∏–≤–Ω–æ–π –§–∞–ª–∫–æ–Ω.jpg")
    },
    {
        "volume": 30,
        "title": "–ì–µ—Ä–æ–π –ü–∏–≤–Ω–æ–≥–æ –®–∏–ª–¥–µ–Ω–∞",
        "message": "–¢—ã –ø–æ–¥–Ω—è–ª –º–æ–ª–æ—Ç –ø–µ–Ω—ã –∏ –¥–æ—Å—Ç–æ–∏–Ω —Ç–æ—Å—Ç–∞ —Å –¢–æ—Ä–æ–º! ‚ö°",
        "icon": "‚ö°",
        "image": os.path.join(ASSETS_PATH, "–ì–µ—Ä–æ–π –ü–∏–≤–Ω–æ–≥–æ –®–∏–ª–¥–µ–Ω–∞.jpg")
    },
    {
        "volume": 40,
        "title": "–•–º–µ–ª—å–Ω–æ–π –î–∂–µ–∫ –í–æ—Ä–æ–±–µ–π",
        "message": "–ì–¥–µ —Ç–≤–æ–µ –ø–∏–≤–æ? –ü–æ—á–µ–º—É –µ–≥–æ –Ω–µ—Ç? –ê, –≤–æ—Ç –æ–Ω–æ, –≤ —Ç–≤–æ–µ–º –∂–µ–ª—É–¥–∫–µ! üè¥‚Äç‚ò†Ô∏è",
        "icon": "üè¥‚Äç‚ò†Ô∏è",
        "image": os.path.join(ASSETS_PATH, "–•–º–µ–ª—å–Ω–æ–π –î–∂–µ–∫ –í–æ—Ä–æ–±–µ–π.jpg")
    },
    {
        "volume": 50,
        "title": "–ü–∏–≤–Ω–æ–π –ì—ç–Ω–¥–∞–ª—å—Ñ",
        "message": "–¢—ã –ø—Ä–æ—à–µ–ª —á–µ—Ä–µ–∑ –ø–∞–±—ã –∏ –ø–µ–Ω—ã, –∏ –≤—ã—à–µ–ª —Å –ø–æ–ª–Ω—ã–º –±–æ–∫–∞–ª–æ–º! üßô‚Äç‚ôÇÔ∏è",
        "icon": "üßô‚Äç‚ôÇÔ∏è",
        "image": os.path.join(ASSETS_PATH, "–ü–∏–≤–Ω–æ–π –ì—ç–Ω–¥–∞–ª—å—Ñ 2.png")
    },
    {
        "volume": 75,
        "title": "–•–º–µ–ª–µ–≤–æ–π –î–∂–æ–∫–µ—Ä",
        "message": "–ü–æ—á–µ–º—É —Ç–∞–∫ —Å–µ—Ä—å–µ–∑–Ω–æ? –î–∞–≤–∞–π –Ω–∞–ª—å–µ–º –µ—â–µ –ø–∏–≤–∞ –∏ —É—Å—Ç—Ä–æ–∏–º —Ö–∞–æ—Å! üÉè",
        "icon": "üÉè",
        "image": os.path.join(ASSETS_PATH, "–•–º–µ–ª–µ–≤–æ–π –î–∂–æ–∫–µ—Ä.png")
    },
    {
        "volume": 100,
        "title": "–ü–µ–Ω–Ω—ã–π –î–æ–∫—Ç–æ—Ä –°—Ç—Ä—ç–Ω–¥–∂",
        "message": "–¢—ã –æ—Å–≤–æ–∏–ª –º—É–ª—å—Ç–∏–≤—Å–µ–ª–µ–Ω–Ω—É—é –ø–∏–≤–∞ –∏ –æ—Ç–∫—Ä—ã–ª –ø–æ—Ä—Ç–∞–ª –≤ —Ö–º–µ–ª—å–Ω–æ–π —Ä–∞–π! üåÄ",
        "icon": "üåÄ",
        "image": os.path.join(ASSETS_PATH, "–ü–µ–Ω–Ω—ã–π –î–æ–∫—Ç–æ—Ä –°—Ç—Ä—ç–Ω–¥–∂.png")
    }
]

def get_achievement_for_volume(total_volume):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–º–∞ –ø–∏–≤–∞.
    
    Args:
        total_volume (float): –û–±—â–∏–π –æ–±—ä–µ–º –≤—ã–ø–∏—Ç–æ–≥–æ –ø–∏–≤–∞
        
    Returns:
        dict or None: –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –∏–ª–∏ None, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
    """
    current_achievement = None
    
    # –ù–∞—Ö–æ–¥–∏–º —Å–∞–º–æ–µ –≤—ã—Å–æ–∫–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–±—ä–µ–º—É
    for achievement in ACHIEVEMENTS:
        if total_volume >= achievement["volume"]:
            current_achievement = achievement
        else:
            # –°–ø–∏—Å–æ–∫ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –æ–±—ä–µ–º–∞, 
            # —Ç–∞–∫ —á—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å —Ü–∏–∫–ª, –∫–æ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏–º –æ–±—ä–µ–º –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–≥–æ
            break
    
    return current_achievement

def check_new_achievement(old_volume, new_volume):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç–∏–≥ –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤–æ–≥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
    
    Args:
        old_volume (float): –°—Ç–∞—Ä—ã–π –æ–±—â–∏–π –æ–±—ä–µ–º –≤—ã–ø–∏—Ç–æ–≥–æ –ø–∏–≤–∞
        new_volume (float): –ù–æ–≤—ã–π –æ–±—â–∏–π –æ–±—ä–µ–º –≤—ã–ø–∏—Ç–æ–≥–æ –ø–∏–≤–∞
        
    Returns:
        dict or None: –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–æ–≤–æ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –∏–ª–∏ None, –µ—Å–ª–∏ –Ω–µ—Ç –Ω–æ–≤–æ–≥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    """
    old_achievement = get_achievement_for_volume(old_volume)
    new_achievement = get_achievement_for_volume(new_volume)
    
    # –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –∑–Ω–∞—á–∏—Ç –ø–æ–ª—É—á–µ–Ω–æ –Ω–æ–≤–æ–µ
    if new_achievement and (not old_achievement or old_achievement["volume"] < new_achievement["volume"]):
        return new_achievement
    
    return None

def format_achievement_message(achievement, username):
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏.
    
    Args:
        achievement (dict): –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏
        username (str): –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏
    """
    return (f"üèÜ –ù–û–í–û–ï –î–û–°–¢–ò–ñ–ï–ù–ò–ï! üèÜ\n\n"
            f"{username} –¥–æ—Å—Ç–∏–≥(–ª–∞) –∑–≤–∞–Ω–∏—è ¬´{achievement['title']}¬ª!\n"
            f"{achievement['message']}\n\n"
            f"–û–±—ä–µ–º –≤—ã–ø–∏—Ç–æ–≥–æ –ø–∏–≤–∞: {achievement['volume']}+ –ª–∏—Ç—Ä–æ–≤") 